<?xml version="1.0"?>
<robot name="tracked_bot">

  <!-- ======================= 链接 ========================= -->
  <!-- 底盘本体 -->
  <link name="base_link">
    <inertial>
      <mass value="8.0"/>
      <!-- Origin: xyz="0 0 (body_h/2 + track_h/2)" -->
      <origin xyz="0 0 0.61" rpy="0 0 0"/>
      <!-- Inertia calculated for box: l=1.45, w=1.33, h=1.12, m=8.0 -->
      <inertia ixx="1.45957" iyy="1.65387" izz="2.43867"
               ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <!-- Origin: xyz="0 0 track_h / 2" -->
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry><box size="1.45 1.33 1.12"/></geometry>
      <material name="grey"><color rgba="0.2 0.2 0.2 1"/></material>
    </visual>
    <collision>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry><box size="1.45 1.33 1.12"/></geometry>
    </collision>
  </link>

  <!-- 左履带 -->
  <link name="left_track_link">
    <inertial>
      <mass value="1.5"/>
      <!-- Origin: xyz="0 0 track_h/2" -->
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <inertia ixx="0.1" iyy="0.1" izz="0.1" ixy="0" ixz="0" iyz="0"/> <!-- Simplified -->
    </inertial>
    <visual>
       <origin xyz="0 0 0.05" rpy="0 0 0"/>
       <!-- Size: track_l=1.3775, track_w=0.15, track_h=0.1 -->
      <geometry><box size="1.3775 0.15 0.1"/></geometry>
      <material name="black"><color rgba="0.05 0.05 0.05 1"/></material>
    </visual>
    <collision>
       <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry><box size="1.3775 0.15 0.1"/></geometry>
    </collision>
  </link>

  <!-- 右履带 -->
    <link name="right_track_link">
    <inertial>
      <mass value="1.5"/>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <inertia ixx="0.1" iyy="0.1" izz="0.1" ixy="0" ixz="0" iyz="0"/> <!-- Simplified -->
    </inertial>
    <visual>
       <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry><box size="1.3775 0.15 0.1"/></geometry>
      <material name="black"><color rgba="0.05 0.05 0.05 1"/></material>
    </visual>
    <collision>
       <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry><box size="1.3775 0.15 0.1"/></geometry>
    </collision>
  </link>

  <!-- ======================= 关节 ========================= -->
  <!-- 左履带固定关节 -->
  <joint name="left_track_fixed_joint" type="fixed">
    <parent link="base_link"/>
    <child link="left_track_link"/>
    <!-- Origin: xyz="0 body_w/2 0" -> "0 0.665 0" -->
    <origin xyz="0 0.665 0" rpy="0 0 0"/>
  </joint>

  <!-- 右履带固定关节 -->
  <joint name="right_track_fixed_joint" type="fixed">
    <parent link="base_link"/>
    <child link="right_track_link"/>
    <!-- Origin: xyz="0 -body_w/2 0" -> "0 -0.665 0" -->
    <origin xyz="0 -0.665 0" rpy="0 0 0"/>
  </joint>

  <!-- ==================== ros2_control ==================== -->
  <!-- Temporarily commented out for debugging URDF parsing -->
  <!--
  <ros2_control name="TrackedBotHardware" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>

    <joint name="left_track_driver_joint">
      <command_interface name="velocity">
          <param name="min">-10</param>
          <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
    </joint>
    <joint name="right_track_driver_joint">
      <command_interface name="velocity">
          <param name="min">-10</param>
          <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
    </joint>

    <controller name="diff_cont" type="diff_drive_controller/DiffDriveController">
      <ros__parameters>
        left_wheel_names:  ["left_track_driver_joint"]
        right_wheel_names: ["right_track_driver_joint"]
        wheel_separation:  1.33  # body_w
        wheel_radius:      1.0 # virtual_track_radius
        publish_rate:      50.0
        use_stamped_vel:   true
        base_frame_id:     base_link
        odom_frame_id:     odom
      </ros__parameters>
    </controller>
  </ros2_control>
  -->

  <!-- ====================== Gazebo ==================== -->
  <gazebo>
     <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so"/>
  </gazebo>

  <gazebo reference="left_track_link">
    <mu1>1.5</mu1>
    <mu2>1.5</mu2>
    <material>Gazebo/DarkGrey</material>
  </gazebo>
  <gazebo reference="right_track_link">
    <mu1>1.5</mu1>
    <mu2>1.5</mu2>
    <material>Gazebo/DarkGrey</material>
  </gazebo>
   <gazebo reference="base_link">
    <material>Gazebo/Grey</material>
  </gazebo>

</robot> 